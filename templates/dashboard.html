<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JEEVIKA â€“ Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<style>
:root {
    --primary:#8e44ad;
    --primary-light:#c084fc;
    --bg:#faf7ff;
    --card:#ffffff;
    --soft:#f5f0ff;
    --text-dark:#2d1b4e;
    --muted:#777;
}

*{box-sizing:border-box}

body{
    margin:0;
    font-family:"Inter",sans-serif;
    background:var(--bg);
    display:flex;
    height:100vh;
}

/* SIDEBAR */

.sidebar{
    width:240px;
    background:white;
    border-right:1px solid #eee;
    padding:30px 20px;
    display:flex;
    flex-direction:column;
}

.logo{
    font-weight:700;
    font-size:18px;
    color:var(--primary);
    margin-bottom:35px;
}

.plan-badge{
    font-size:11px;
    padding:4px 8px;
    border-radius:12px;
    margin-left:6px;
}

.pro{
    background:linear-gradient(90deg,#8e44ad,#c084fc);
    color:white;
}

.free{
    background:#eee;
    color:#555;
}

.menu-item{
    padding:12px 14px;
    border-radius:12px;
    cursor:pointer;
    margin-bottom:8px;
    font-size:14px;
    transition:0.2s;
}

.menu-item:hover{background:var(--soft)}
.menu-item.active{
    background:var(--primary);
    color:white;
}

/* MAIN */

.main{
    flex:1;
    display:flex;
    flex-direction:column;
}

.topbar{
    height:70px;
    background:white;
    display:flex;
    justify-content:flex-end;
    align-items:center;
    padding:0 30px;
    border-bottom:1px solid #eee;
    font-size:13px;
}

.topbar span{
    margin-left:20px;
    cursor:pointer;
}

/* CONTENT */

.content{
    flex:1;
    padding:30px;
    overflow-y:auto;
}

.card{
    background:white;
    border-radius:24px;
    padding:25px;
    box-shadow:0 20px 40px rgba(0,0,0,0.05);
}

/* CHAT */

.chat-card{
    display:flex;
    flex-direction:column;
    height:100%;
}

.messages{
    flex:1;
    overflow-y:auto;
    padding:10px 0;
}

.message{
    max-width:70%;
    padding:14px 18px;
    border-radius:20px;
    margin-bottom:14px;
    font-size:14px;
    animation:fadeIn 0.3s ease;
}

.user{
    background:var(--primary);
    color:white;
    margin-left:auto;
}

.bot{
    background:var(--soft);
    color:var(--text-dark);
}

@keyframes fadeIn{
    from{opacity:0;transform:translateY(5px)}
    to{opacity:1;transform:translateY(0)}
}

/* INPUT */

.input-area{
    display:flex;
    margin-top:15px;
}

.input-area input{
    flex:1;
    padding:14px;
    border-radius:25px;
    border:1px solid #ddd;
}

.input-area button{
    margin-left:10px;
    padding:14px 22px;
    border-radius:25px;
    border:none;
    background:var(--primary);
    color:white;
    cursor:pointer;
}

/* LOCK OVERLAY */

.lock-overlay{
    position:relative;
}

.locked-content{
    filter:blur(3px);
    pointer-events:none;
}

.lock-box{
    position:absolute;
    top:40%;
    left:50%;
    transform:translate(-50%,-50%);
    text-align:center;
}

.upgrade-btn{
    margin-top:15px;
    padding:10px 20px;
    border-radius:20px;
    border:none;
    background:linear-gradient(90deg,#8e44ad,#c084fc);
    color:white;
    cursor:pointer;
    font-weight:600;
}
</style>
</head>

<body>

<div class="sidebar">
    <div class="logo">
        ðŸŒ¿ JEEVIKA
        {% if is_pro %}
            <span class="plan-badge pro">PRO</span>
        {% else %}
            <span class="plan-badge free">FREE</span>
        {% endif %}
    </div>

    <div class="menu-item active" id="chat-menu" onclick="showTab('chat')">ðŸ’¬ Chat</div>
    <div class="menu-item" id="insights-menu" onclick="showTab('insights')">ðŸ“Š Insights</div>
    <div class="menu-item" id="reports-menu" onclick="showTab('reports')">ðŸ“„ Reports</div>
</div>

<div class="main">

    <div class="topbar">
        {% if not is_pro %}
            <span onclick="upgrade()">Upgrade to Pro</span>
        {% else %}
            <span>ðŸŒŸ Premium Active</span>
        {% endif %}
        <span onclick="clearChat()">Clear</span>
        <span onclick="logout()">Logout</span>
    </div>

    <div class="content">

        <!-- CHAT -->
        <div id="chat-tab">
            <div class="card chat-card">

                <div class="messages" id="chat">
                    {% for msg in messages %}
                        <div class="message {{ 'user' if msg.role == 'user' else 'bot' }}">
                            {{ msg.text }}
                        </div>
                    {% endfor %}
                </div>

                <form method="POST" class="input-area">
                    <input type="text" name="message" required>
                    <button type="submit">Send</button>
                </form>

            </div>
        </div>

        <!-- INSIGHTS -->
        <div id="insights-tab" style="display:none;">
            <div class="card">
                <h3>Health Overview</h3>
                <p>PCOS Score: <strong>{{ memory.pcos_score }}</strong></p>
                <p>Iron Score: <strong>{{ memory.iron_score }}</strong></p>
                <p>Risk Level: <strong>{{ memory.clinical_risk }}</strong></p>
            </div>
        </div>

        <!-- REPORTS -->
        <div id="reports-tab" style="display:none;">
            {% if is_pro %}
                <div class="card">
                    <h3>Premium Health Reports</h3>
                    <p>Download advanced hormone analytics & emotional insights.</p>
                    <button class="upgrade-btn">Generate Report</button>
                </div>
            {% else %}
                <div class="lock-overlay">
                    <div class="card locked-content">
                        <h3>Premium Health Reports</h3>
                        <p>Download advanced hormone analytics & emotional insights.</p>
                    </div>

                    <div class="lock-box">
                        <h3>ðŸ”’ Premium Feature</h3>
                        <p>Upgrade to unlock detailed health reports.</p>
                        <button class="upgrade-btn" onclick="upgrade()">Upgrade Now</button>
                    </div>
                </div>
            {% endif %}
        </div>

    </div>
</div>

<script>
function logout(){ window.location.href="/logout"; }
function clearChat(){ window.location.href="/clear"; }

function showTab(tab){
    document.getElementById("chat-tab").style.display="none";
    document.getElementById("insights-tab").style.display="none";
    document.getElementById("reports-tab").style.display="none";
    document.getElementById(tab+"-tab").style.display="block";

    document.querySelectorAll(".menu-item").forEach(i=>i.classList.remove("active"));
    document.getElementById(tab+"-menu").classList.add("active");
}

/* RAZORPAY PAYMENT */

function upgrade(){
    fetch("/create-order",{method:"POST"})
    .then(res=>res.json())
    .then(data=>{
        var options = {
            "key": data.razorpay_key,
            "amount": data.amount,
            "currency": "INR",
            "name": "JEEVIKA PRO",
            "description": "Premium Subscription",
            "order_id": data.order_id,
            "handler": function (response){
                fetch("/verify-payment",{
                    method:"POST",
                    headers:{ "Content-Type":"application/json" },
                    body:JSON.stringify(response)
                })
                .then(res=>res.json())
                .then(result=>{
                    if(result.success){
                        alert("ðŸŽ‰ Payment Successful! PRO Activated.");
                        location.reload();
                    } else {
                        alert("Payment verification failed.");
                    }
                });
            }
        };
        var rzp = new Razorpay(options);
        rzp.open();
    });
}

const chat=document.getElementById("chat");
chat.scrollTop=chat.scrollHeight;
</script>

</body>
</html>
